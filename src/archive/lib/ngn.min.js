/**
  * v1.3.15 generated on: Thu Jun 22 2017 02:53:09 GMT+0000 (UTC)
  * Copyright (c) 2014-2017, Ecor Ventures LLC. All Rights Reserved.
  * See LICENSE (BSD-3-Clause) at
  * https://github.com/ngnjs/chassis-lib/blob/master/LICENSE.
  */
function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};if(window.NGN={},Object.defineProperty(NGN,"define",{enumerable:!1,writable:!1,configurable:!1,value:function(e,t,i,n){return{enumerable:e,writable:t,configurable:i,value:n}}}),Object.defineProperties(NGN,{public:NGN.define(!1,!1,!1,function(e){return NGN.define(!0,"function"!=typeof e,!1,e)}),private:NGN.define(!1,!1,!1,function(e){return NGN.define(!1,"function"!=typeof e,!1,e)}),const:NGN.define(!1,!1,!1,function(e){return NGN.define(!0,!1,!1,e)}),privateconst:NGN.define(!1,!1,!1,function(e){return NGN.define(!1,!1,!1,e)}),get:NGN.define(!1,!1,!1,function(e){return{enumerable:!1,get:e}}),set:NGN.define(!1,!1,!1,function(e){return{enumerable:!1,set:e}}),getset:NGN.define(!1,!1,!1,function(e,t){return{enumerable:!1,get:e,set:t}})}),Object.defineProperties(NGN,{extend:NGN.privateconst(function(e,t){Object.defineProperty(this,e,t)}),inherit:NGN.const(function(e,t){e&&t&&(e="function"==typeof e?e.prototype:e,t="function"==typeof t?t.prototype:t,Object.getOwnPropertyNames(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n)}),Object.getOwnPropertyNames(Object.getPrototypeOf(e)).filter(function(e){return"constructor"!==e.trim().toLowerCase()&&!t.hasOwnProperty(e)}).forEach(function(i){void 0===Object.getOwnPropertyDescriptor(e,i)&&"function"==typeof e[i]&&Object.defineProperty(t,i,NGN.const(function(){return e[i].apply(this,arguments)}))}))}),slice:NGN.private(function(e){return Array.prototype.slice.call(e)}),splice:NGN.private(function(e){return Array.prototype.splice.call(e)}),coalesce:NGN.public(function(){for(var e=0;e<arguments.length;e++)try{if(void 0!==arguments[e]&&null!==arguments[e])return arguments[e]}catch(e){}return null}),nodelike:NGN.get(function(){try{return void 0!==process}catch(e){return!1}}),dedupe:NGN.private(function(e){return e.filter(function(t,i){return e.indexOf(t)===i})}),typeof:NGN.privateconst(function(e){var t=Object.prototype.toString.call(e).split(" ")[1].replace(/\]|\[/gi,"").toLowerCase();if("function"===t){if(!e.name)return e.toString().replace(/\n/gi,"").replace(/^function\s|\(.*$/gim,"").toLowerCase();t=e.name||"function"}return t.toLowerCase()}),processStackItem:NGN.privateconst(function(e,t){return e.replace(/at.*\(|\)/gi,"").replace(t,"./").replace(/\/{2,100}/gi,"/").trim().split(":")}),stack:NGN.get(function(){var e=this,t=(new Error).stack.split("\n")||[],i=/at.*\(/gi;return t=t.filter(function(e){return e.split(":").length>1}).map(function(t){var n=i.exec(t);return n&&(n=n[0].replace(/^at\s{1,100}|\s{1,100}\($/gi,"").replace("<anonymous>","console")),e.nodelike?(t=e.processStackItem(t.toString(),process.cwd()),{path:t.join(":").replace("./",process.cwd()+"/"),file:t[0].substr(0,t[0].length),line:parseInt(t[1],10),column:parseInt(t[2],10),operation:n}):(t=e.processStackItem(t.toString(),window.location.origin),{path:t[0].substr(1,t[0].length-1)+":"+t[1]+":"+t[2],file:t[0].substr(1,t[0].length-1),line:parseInt(t[1],10),column:parseInt(t[2],10),operation:n})}),0===t.length?[{path:"unknown",file:"unknown",line:0,column:0}]:(this.nodelike&&t.reverse(),t)}),css:NGN.get(function(){return NGN.nodelike?"":"font-weight: bold;"}),isFn:NGN.privateconst(function(e){return"function"==typeof e}),wrap:NGN.privateconst(function(e,t){return function(){e.apply(void 0,arguments),t.apply(void 0,arguments)}}),wrapClass:NGN.privateconst(function(e,t){return function(){return e.apply(void 0,arguments),new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.call(arguments))))}}),deprecate:NGN.privateconst(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"The method has been deprecated.";return this.wrap(function(){NGN.nodelike?console.warn("DEPRECATION NOTICE: "+t):console.warn("%cDEPRECATION NOTICE: %c"+t,NGN.css,"font-weight: normal;")},e)}),deprecateClass:NGN.privateconst(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"The class has been deprecated.";return this.wrapClass(function(){NGN.nodelike?console.warn("DEPRECATION NOTICE: "+t):console.warn("%cDEPRECATION NOTICE: %c"+t,NGN.css,"font-weight: normal;")},e)}),needs:NGN.private(function(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("NGN.uses() requires an object.");for(var t=[],i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var o in n)e.hasOwnProperty(n[o])||t.push(n[o]);if(t.length>0)throw new MissingDependencyError(("Missing "+e.constructor.name+" dependencies: "+t.join(", ")).replace(/\s{2,100}/gi," "))}),createAlias:NGN.private(function(e,t,i){Object.defineProperty(e,t,NGN.get(function(){return i}))})}),Object.defineProperty(NGN,"global",NGN.privateconst(NGN.nodelike?global:window)),document.addEventListener("DOMContentLoaded",function(){document.body.classList.add("ngn")}),!window.NGN)throw new Error("The EventEmitter class is dependent on the presence of NGN.");var EventEmitter=function(){function e(t){_classCallCheck(this,e),t=t||{},Object.defineProperties(this,{handlers:NGN.private({}),adhoc:NGN.private({}),maxlisteners:NGN.private(t.defaultMaxListeners||25)})}return _createClass(e,[{key:"listenerCount",value:function(e){return(this.handlers[e]||[]).length+(this.adhoc[e]||[]).length}},{key:"getMaxListeners",value:function(){return this.defaultMaxListeners}},{key:"setMaxListeners",value:function(e){this.defaultMaxListeners=e}},{key:"eventNames",value:function(){var e=Object.keys(this.handlers),t=Object.keys(this.adhoc);return NGN.dedupe(e.concat(t))}},{key:"listeners",value:function(e){var t=this.handlers[e]||[],i=this.adhoc[e]||[];return t.concat(i)}},{key:"on",value:function(e,t,i){if("object"===(void 0===e?"undefined":_typeof(e)))return this.pool(e);if(this.handlers[e]=this.handlers[e]||[],this.handlers[e][NGN.coalesce(i,!1)?"unshift":"push"](t),this.emit("newListener",e,t),this.listenerCount(e)>this.maxlisteners)throw new Error("Maximum event listeners exceeded. Use setMaxListeners() to adjust the level.")}},{key:"addListener",value:function(){this.on.apply(this,arguments)}},{key:"prependListener",value:function(){var e=NGN.slice(arguments).push(!0);this.on.apply(this,e)}},{key:"once",value:function(e,t,i){if(this.adhoc[e]=this.adhoc[e]||[],this.adhoc[e][NGN.coalesce(i,!1)?"unshift":"push"](t),this.emit("newListener",e,t),this.listenerCount(e)>this.maxlisteners)throw new Error("Maximum event listeners exceeded. Use setMaxListeners() to adjust the level.")}},{key:"prependOnceListener",value:function(){var e=NGN.slice(arguments).push(!0);this.once.apply(this,e)}},{key:"off",value:function(e,t){this.deleteEventHandler("handlers",e,t)}},{key:"onceoff",value:function(e,t){this.deleteEventHandler("adhoc",e,t)}},{key:"deleteEventHandler",value:function(e,t,i){var n=this[e];if(n[t]){if(!i)return void delete n[t];var r=[];if(n[t].forEach(function(e){e.toString()!==i.toString()&&r.push(e)}),0===r.length)return void delete n[t];n[t]=r}}},{key:"removeListener",value:function(){this.off.apply(this,arguments),this.onceoff.apply(this,arguments)}},{key:"clear",value:function(){var e=this;arguments.length>0?NGN.slice(arguments).forEach(function(t){delete e.handlers[t],delete e.adhoc[t]}):(this.handlers={},this.adhoc={})}},{key:"removeAllListeners",value:function(){this.clear.apply(this,arguments)}},{key:"emit",value:function(){var e=NGN.slice(arguments),t=e.shift(),i=this.getAllEvents(t),n={event:t};for(var r in i){var o=this.adhoc[i[r]];if(o)for(delete this.adhoc[i[r]];o.length>0;){var a=o.pop();n.handler=a,a.apply(n,e)}var s=this.handlers[i[r]];if(s)for(var l in s)n.handler=s[l],s[l].apply(n,e)}}},{key:"getAllEvents",value:function(e){var t=Object.keys(this.handlers),i=Object.keys(this.adhoc),n=NGN.dedupe(t.concat(i));return n=n.filter(function(t){return t===e||("regexp"===NGN.typeof(t)||t.indexOf("*")>=0)&&("regexp"!==NGN.typeof(t)&&(t=new RegExp(t.replace("*",".*","gi"))),t.test(e))})}},{key:"subscribers",get:function(){var e={};for(var t in this.handlers)e[t]={handler:this.handlers[t].length,adhoc:0};for(var i in this.adhoc)e[i]=e[i]||{handler:0},e[i].adhoc=this.adhoc[i].length;return e}},{key:"defaultMaxListeners",get:function(){return this.maxlisteners},set:function(e){this.maxlisteners=e}}]),e}();NGN.extend("EventEmitter",NGN.private(EventEmitter)),NGN.inherit(Object.defineProperties({},{queued:NGN.private({}),collectionQueue:NGN.private({}),thresholdQueue:NGN.private({}),deprecate:NGN.const(function(e,t){var i=void 0;(void 0).on(e,function(){if(console.warn(e+" is deprecated."+(t?"Use "+t+" instead.":"")),t){var n=NGN.slice(arguments);n.shift(),n.unshift(t),i.emit.apply(i,n)}})}),pool:NGN.const(function(e,t,i){"string"!=typeof e&&(t=e,e="");var n={};for(var r in t){var o=(e.trim()||"")+r;"function"==typeof t[r]?(this.setMaxListeners(this.getMaxListeners()+1),n[r]=this.on(o,t[r])):"object"===_typeof(t[r])?this.pool(o+".",t[r]):console.warn("%c"+o+"%c could not be pooled in the event emitter because it's value is not a function.",NGN.css,"")}NGN.isFn(i)&&i(n)}),attach:NGN.const(function(e,t){var i=arguments,n=this;return t=NGN.coalesce(t,!1),function(r){t&&"function"==typeof r.preventDefault&&r.preventDefault();var o=NGN.slice(i);o.unshift(e),n.emit.apply(n,o)}}),forward:NGN.const(function(e,t,i){var n=this;t="string"==typeof t?[t]:t;var r=this,o=function(){var e=NGN.slice(arguments);i&&e.push(i);for(var n in t){var o=e.slice();o.unshift(t[n]),r.emit.apply(r,o)}};return this.setMaxListeners(this.getMaxListeners()+1),this.on(e,o),{remove:function(){n.setMaxListeners(n.getMaxListeners()-1),n.off(e,o)}}}),bind:NGN.privateconst(function(){return NGN.deprecate(this.forward,"NGN.BUS.bind is now NGN.BUS.forward").apply(void 0,arguments)}),delayEmit:NGN.const(function(e,t){var i=this;if(!this.queued.hasOwnProperty(e)){var n=NGN.slice(arguments);n.splice(1,1),this.queued[e]=setTimeout(function(){delete i.queued[e],i.emit.apply(i,n)},t)}}),queue:NGN.privateconst(function(){return NGN.deprecate(this.delayEmit,"NGN.BUS.queue is now NGN.BUS.delayEmit").apply(void 0,arguments)}),funnel:NGN.const(function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Array.isArray(e))throw new Error("NGN.BUS.bindEvents expected an array of events, but received a(n) "+(void 0===e?"undefined":_typeof(e)));e=NGN.dedupe(e);var r=this,o=this.getInternalCollectionId(this.collectionQueue);return this.collectionQueue[o]={},Object.defineProperties(this.collectionQueue[o],{masterqueue:NGN.const(e),remainingqueue:NGN.private(e),eventName:NGN.const(t),remove:NGN.const(function(){var e=r.collectionQueue[o].masterqueue.slice();delete r.collectionQueue[o],e.forEach(function(e){r.setMaxListeners(r.getMaxListeners()-1),r.off(e,r.handleCollectionTrigger(e,o))})}),payload:NGN.const(n)}),e.forEach(function(e){r.setMaxListeners(r.getMaxListeners()+1),i.on(e,i.handleCollectionTrigger(e,o))}),this.collectionQueue[o]}),getInternalCollectionId:NGN.privateconst(function(e){for(var t=(new Date).getTime().toString(),i=Math.random().toString(),n=Object.keys(e).length+1;e.hasOwnProperty(n.toString()+t+i);)n++;return n.toString()+t+i}),handleCollectionTrigger:NGN.privateconst(function(e,t){var i=this;return function(){setTimeout(function(){i.collectionQueue.hasOwnProperty(t)&&(i.collectionQueue[t].remainingqueue.indexOf(e)>=0&&(i.collectionQueue[t].remainingqueue=i.collectionQueue[t].remainingqueue.filter(function(t){return t!==e})),0===i.collectionQueue[t].remainingqueue.length&&(i.collectionQueue[t].remainingqueue=i.collectionQueue[t].masterqueue,NGN.isFn(i.collectionQueue[t].eventName)?i.collectionQueue[t].eventName(i.collectionQueue[t].payload):i.emit(i.collectionQueue[t].eventName,i.collectionQueue[t].payload)))},0)}}),funnelOnce:NGN.const(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.funnel(e,t,i);this.setMaxListeners(this.getMaxListeners()+1),this.once(t,function(){n.remove(),n=null})}),threshold:NGN.const(function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("string"!=typeof e)throw new Error("The threshold event name must be a string (received "+(void 0===e?"undefined":_typeof(e))+")");var r=this,o=this.getInternalCollectionId(this.thresholdQueue)+t.toString();return this.thresholdQueue[o]={},Object.defineProperties(this.thresholdQueue[o],{key:NGN.const(o),eventName:NGN.const(e),limit:NGN.const(t),count:NGN.private(0),finalEventName:NGN.const(i),remove:NGN.const(function(){var e=r.thresholdQueue[o].eventName;delete r.thresholdQueue[o],r.setMaxListeners(r.getMaxListeners()-1),r.off(e,r.handleThresholdTrigger(o))}),payload:NGN.const(n)}),this.setMaxListeners(this.getMaxListeners()+1),this.on(e,this.handleThresholdTrigger(o)),this.thresholdQueue[o]}),thresholdOnce:NGN.const(function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=this.threshold(e,t,i,n);this.once(i,function(){r.remove(),r=null})}),handleThresholdTrigger:NGN.const(function(e){var t=this;return function(){setTimeout(function(){t.thresholdQueue.hasOwnProperty(e)&&++t.thresholdQueue[e].count===t.thresholdQueue[e].limit&&(NGN.isFn(t.thresholdQueue[e].finalEventName)?t.thresholdQueue[e].finalEventName(t.thresholdQueue[e].payload):t.emit(t.thresholdQueue[e].finalEventName,t.thresholdQueue[e].payload),t.thresholdQueue.hasOwnProperty(e)&&(t.thresholdQueue[e].count=0))},0)}})}),NGN.EventEmitter);var CustomException=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e=e||{},e="string"==typeof e?{message:e}:e,e.custom=e.custom||{};var n=i;i.name=e.name||"NgnError",i.type=e.type||"TypeError",i.severity=e.severity||"minor",i.message=e.message||"Unknown Error",i.category=e.category||"operational",i.name=i.name.replace(/[^a-zA-Z0-9_]/gi,"");for(var r in e.custom)e.custom.hasOwnProperty(r)&&(i[r]=e.custom[r]);if(i.hasOwnProperty("custom")&&delete i.custom,NGN.nodelike||Error.prepareStackTrace){Error.prepareStackTrace=function(e,t){return t};var o=new Error;Error.captureStackTrace(o,i),i.rawstack=o.stack,Error.prepareStackTrace=function(e,t){return n.cause&&console.warn(n.cause),n.help&&console.info(n.help),n.name+": "+n.message+"\n"+t.filter(function(e){return e.getFileName()!==__filename&&e.getFileName()}).map(function(e){return"    at "+e}).join("\n")},Error.captureStackTrace(i)}return i}return _inherits(t,e),_createClass(t,[{key:"trace",get:function(){return this.rawstack.filter(function(e){return e.getFileName()!==__filename&&e.getFileName()}).map(function(e){return{filename:e.getFileName(),line:e.getLineNumber(),column:e.getColumnNumber(),functionname:e.getFunctionName(),native:e.isNative(),eval:e.isEval(),type:e.getTypeName()}})}}]),t}(Error);NGN.nodelike&&(module.exports=CustomException),NGN.extend("createException",NGN.public(function(e){e=e||{},e="string"==typeof e?{message:e}:e,e.name=e.name||"NgnError",e.name=e.name.replace(/[^a-zA-Z0-9_]/gi,""),NGN.global[e.name]=function(){return arguments.length>0&&(e.message=arguments[0]),new CustomException(e)}})),NGN.createException({name:"MissingDependencyError",type:"MissingDependencyError",severity:"critical",message:"An NGN dependency is missing or could not be found.",category:"programmer",custom:{help:"Include the missing library.",cause:"A required dependency was not included, or it was not included in the correct sequence."}}),NGN.DOM={},Object.defineProperties(NGN.DOM,{ready:NGN.const(function(e){document.addEventListener("DOMContentLoaded",e)}),destroy:NGN.const(function(e){if("string"==typeof e){var t=e;if(e=document.querySelectorAll(e),0===e.length)return void console.warn('The "'+t+'" selector did not return any elements.');NGN.slice(e).forEach(this.destroy)}else switch(NGN.typeof(e)){case"array":return void e.forEach(this.destroy);case"nodelist":return void NGN.slice(e).forEach(this.destroy);case"htmlelement":return void e.parentNode.removeChild(e);default:if(/^html.*element$/.test(NGN.typeof(e)))return void e.parentNode.removeChild(e);console.warn("An unknown error occurred while trying to remove DOM elements."),console.log("Unknown Element",e)}}),guarantee:NGN.public(function(e,t,i,n){NGN.DOM.guaranteeElement(!0,e,t,i,n)}),guaranteeDirectChild:NGN.public(function(e,t,i,n){NGN.DOM.guaranteeElement(!1,e,t,i,n)}),guaranteeElement:NGN.private(function(e,t,i,n,r){if(NGN.isFn(n)&&(r=n,n=null),"string"==typeof t&&(t=document.querySelector(NGN.DOM.normalizeSelector(t))),"string"==typeof(i=i.indexOf("<")>=0?NGN.DOM.expandVoidHTMLTags(i).toString().trim().toUpperCase():NGN.DOM.normalizeSelector(i)))if(i.indexOf("<")>=0){var o=/<(\w+).*>/i.exec(i);if(!o)return r(new Error("Invalid selector."));o=o[1].toUpperCase();var a=function(e){return e.nodeName===o?NodeFilter.FILTER_ACCEPT:e.hasChildNodes()?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT};i=i.toUpperCase();var s=void 0;try{for(s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a},!1);s.nextNode();){var l=NGN.DOM.expandVoidHTMLTags(s.currentNode.outerHTML.toString().trim()).toUpperCase();if(l===i)return r(null,s.currentNode)}}catch(e){for(s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,a,!1);s.nextNode();){var c=NGN.DOM.expandVoidHTMLTags(s.currentNode.outerHTML.toString().trim()).toUpperCase();if(c===i)return r(null,s.currentNode)}}}else try{var u=document.querySelector(NGN.DOM.getElementSelector(t)+" "+i);if(u&&u instanceof HTMLElement)return r(null,u)}catch(e){}var d=function(e){clearTimeout(n),h.disconnect(),r(null,e)},h=new MutationObserver(function(e){for(var n in e)if("childList"===e[n].type)for(var r=0;r<e[n].addedNodes.length;r++){var o=e[n].addedNodes[r];if("#TEXT"!==o.nodeName.toUpperCase()&&"string"==typeof i)try{if(document.querySelector(NGN.DOM.getElementSelector(t)+" "+i)===o)return d(o)}catch(e){var a=NGN.DOM.expandVoidHTMLTags(o.outerHTML.toString().trim()).toUpperCase();if(i===a)return d(o)}}});h.observe(t,{childList:!0,subtree:e}),null!==n&&"number"==typeof n&&(n=setTimeout(function(){h.disconnect(),r(new Error("Guarantee timed out while waiting for "+i))},n))}),expandVoidHTMLTags:NGN.private(function(e){e=NGN.coalesce(e,"");for(var t=/<[^>]*\/>/gi,i=/<([^\s\/\\]+)/i,n=t.exec(e);null!==n;){for(var r=i.exec(n[0])[1];-1!==e.indexOf(n[0]);)e=e.replace(n[0],n[0].substr(0,n[0].length-2)+"></"+r+">");n=t.exec(e)}return e.replace(/\sXMLNS=".+?"/gi,"").replace(/\s{2,100}/gi," ").replace(/\s{1,1000}>/gi,">").replace(/>\s{1,1000}</gi,"><")}),findParent:NGN.const(function(e,t,i){if("string"==typeof e){if(e=document.querySelectorAll(e),0===e.length)return console.warn('"'+e+'" is an invalid CSS selector (Does not identify any DOM elements).'),null;e=e[0]}var n=e.parentNode,r=0;for(i="number"==typeof i?i:-1;null===n.parentNode.querySelector(t)&&"BODY"!==n.nodeName;){if(r++,i>0&&r>i)return null;n=n.parentNode}return n}),indexOfParent:NGN.const(function(e){return NGN.slice(e.parentNode.children).indexOf(e)}),getElementSelector:NGN.public(function(e,t){if(!(e instanceof HTMLElement))throw new Error("Element is not a valid HTML element");if(!((t=NGN.coalesce(t,document.body))instanceof HTMLElement)){if("string"==typeof t)return t=document.querySelector(t),this.getElementSelector(e,t);console.warn("Parent element of selector is not a valid DOM element. Using %cdocument.body%c instead.",NGN.css,"font-weight: normal;",NGN.css),t=document.body}if(e.hasAttribute("id"))return this.normalizeSelector("#"+e.getAttribute("id"));for(var i=[];e!==t;){if(e.hasAttribute("id"))return i.unshift("#"+e.getAttribute("id")),i.join(" > ");i.unshift(e.nodeName.toLowerCase()+":nth-child("+(this.indexOfParent(e)+1)+")"),e=e.parentNode}return this.normalizeSelector(i.join(" > "))}),normalizeSelector:NGN.private(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.indexOf("#")>=0&&(e=("#"+e.split("#").pop()).toString()),NGN.DOM.escapeCssSelector(e)}),escapeCssSelector:NGN.public(function(e){for(var t=/\#[0-9]/g,i=t.exec(e);i;){var n=i[0].replace("#","");e=e.replace(i[0],"#\\\\3"+n+" "),i=t.exec(e)}return e}),getCommonAncestor:NGN.const(function(e){return this.getCommonAncestorDetail(e).element}),getCommonAncestorDetail:NGN.const(function(e){if(e=NGN.slice(e),1===e.length)return e[0];for(var t=e.map(function(e){var t=NGN.DOM.getElementSelector(e).split(" > ");return t.pop(),t}).sort(function(e,t){return e.length<t.length?-1:e.length>t.length?1:0}),i=[],n=[];t.length>0;){for(var r=[],o=0;o<t.length;o++){var a=t[o].shift();0===t[o].length&&n.push(0),r.push(a)}r=NGN.dedupe(r),1===r.length&&t.length===e.length?(i.push(r.shift()),t=t.filter(function(e){return e.length>0})):(n=n.concat(t.filter(function(e){return e.length>0}).map(function(e){return e.length})),t=[])}i=i.join(" > ");var s=0;return n.forEach(function(e){s+=e}),{element:document.querySelector(i),gap:{min:Math.min.apply(this,n),max:Math.max.apply(this,n),average:Math.ceil(s/n.length),median:n[Math.ceil(n.length/2)-1]}}})}),NGN.extend("BUS",NGN.const(new NGN.EventEmitter));var parser=new DOMParser,fs=NGN.nodelike?require("fs"):null,Network=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{xhr:NGN.privateconst(function(e){var t=new XMLHttpRequest,i=!1;return t.onreadystatechange=function(){if(!i&&4===t.readyState){if(i=!0,!NGN.isFn(e))return t;e(t)}},t.onerror=function(n){NGN.BUS&&NGN.BUS.emit("NETWORKERROR",n),!i&&NGN.isFn(e)&&e(t),i=!0},t}),prepend:NGN.privateconst(function(e,t){return e=NGN.slice(e),e.unshift(t),e}),getFile:NGN.privateconst(function(e){if(null!==fs){var t={status:fs.existsSync(e.replace("file://",""))?200:400};return t.responseText=200===t.status?fs.readFileSync(e.replace("file://","")).toString():"File could not be found.",t}throw new Error(e+" does not exist or could not be found.")}),normalizeUrl:NGN.privateconst(function(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/").replace(/\:\/{3,50}/gi,"://")}),domainRoot:NGN.privateconst(function(e){var t=-1!==e.search(/^https?\:\/\//)?e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i,""):e.match(/^([^\/?#]+)(?:[\/?#]|$)/i,"");return null===t||t[1].length<3?window.location.host:t[1]}),isCrossOrigin:NGN.privateconst(function(e){return this.domainRoot(e)!==window.location.host}),prelink:NGN.privateconst(function(e,t,i){if(!document.head)return void console.warn("Cannot use a preconnect, predns, etc because there is no HEAD in the HTML document.");var n=document.createElement("link");n.rel=t,n.href="http"!==e.trim().toLowerCase().substr(0,4)?this.normalizeUrl(window.location.origin+window.location.pathname+e):e,NGN.coalesce(i,this.isCrossOrigin(e))&&n.setAttribute("crossorigin","true"),document.head.appendChild(n),NGN.BUS.emit("network."+t)}),importCache:NGN.private({}),createElement:NGN.privateconst(function(e){return parser.parseFromString(e,"text/html").querySelector("body").children}),applyData:NGN.privateconst(function(e,t,i){if(void 0===e)return console.warn("Empty template."),void(NGN.isFn(i)&&i());Object.keys(t).forEach(function(i){var n=new RegExp("{{"+i+"}}","gm");e=e.replace(n,t[i])}),e=e.replace(/(\{\{.*\}\})/gm,""),NGN.isFn(i)&&i(e)}),_ttl:NGN.private(1e4)}),e}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e,t,i){var n=NGN.NET.xhr(i);n.open(e,t,!0),n.send()}},{key:"runSync",value:function(e,t){var i=NGN.NET.xhr();return i.open(e,t,!1),i.send(),i}},{key:"applyRequestSettings",value:function(e,t){if(!e||!t)throw new Error("No XHR or configuration object defined.");if(t.params){var i=Object.keys(t.params).map(function(e){return e+"="+encodeURIComponent(t.params[e])});t.url+="?"+i.join("&")}e.open(t.method||"POST",t.url,!0),t.header=t.header||t.headers||{},Object.keys(t.header).forEach(function(i){e.setRequestHeader(i,t.header[i])});var n=null;return t.json?((!t.header||t.header&&!t.header["Content-Type"])&&e.setRequestHeader("Content-Type","application/json"),n=JSON.stringify(t.json).trim()):t.body?((!t.header||t.header&&!t.header["Content-Type"])&&e.setRequestHeader("Content-Type","application/text"),n=t.body):t.form&&(n=new FormData,Object.keys(t.form).forEach(function(e){n.append(e,t.form[e])})),t.withCredentials&&(e.withCredentials=t.withCredentials),t.header.hasOwnProperty("Authorization")||(t.username&&t.password?e.setRequestHeader("Authorization","Basic "+btoa(t.username+":"+t.password)):t.accessToken&&e.setRequestHeader("Authorization","Bearer "+t.accessToken)),n}},{key:"send",value:function(e,t){e=e||{};var i=this.xhr(NGN.coalesce(t)),n=this.applyRequestSettings(i,e);return i.send(n),i}},{key:"prepareSubmissionConfiguration",value:function(e,t){return"string"==typeof e&&(e={url:e}),e=e||{},e.method=t.toUpperCase(),e.url=e.url||window.location,e}},{key:"retrieve",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],function(){"string"==typeof arguments[0]&&(arguments[0]={url:arguments[0]});var t=arguments[0];return t.method=e,t.url="string"==typeof arguments[1]?arguments[1]:t.url,NGN.nodelike&&"file://"===t.url.substr(0,7).toLowerCase()?arguments[arguments.length-1](this.getFile(t.url)):this.send(t,arguments[arguments.length-1])}}},{key:"get",value:function(){this.retrieve("GET").apply(this,arguments)}},{key:"getSync",value:function(){return this.retrieve("GET",!0).apply(this,arguments)}},{key:"head",value:function(e,t){this.retrieve("HEAD").apply(this,arguments)}},{key:"headSync",value:function(e){return this.retrieve("HEAD",!0).apply(this,arguments)}},{key:"put",value:function(e,t){this.send(this.prepareSubmissionConfiguration(e,"PUT"),t)}},{key:"putSync",value:function(e){return this.send(this.prepareSubmissionConfiguration(e,"PUT"))}},{key:"post",value:function(e,t){this.send(this.prepareSubmissionConfiguration(e,"POST"),t)}},{key:"postSync",value:function(e){return this.send(this.prepareSubmissionConfiguration(e,"POST"))}},{key:"delete",value:function(e,t){this.send(this.prepareSubmissionConfiguration(e,"DELETE"),t)}},{key:"deleteSync",value:function(e){return this.send(this.prepareSubmissionConfiguration(e,"DELETE"))}},{key:"runJsonRequest",value:function(e,t,i){if("string"==typeof e&&(i=t,t=e,e=null),e=e||{url:t},NGN.isFn(i))this.get(e,function(e){try{var t=JSON.parse(e.responseText);i(null,t)}catch(t){t.response=NGN.coalesce(e),i(t,null)}});else try{var n=this.getSync(e);try{return JSON.parse(n.responseText)}catch(e){throw e.response=NGN.coalesce(n),e}}catch(e){throw e.response=null,e}}},{key:"json",value:function(e,t,i){this.runJsonRequest(e,t,i)}},{key:"jsonSync",value:function(e,t){return this.runJsonRequest(e,t)}},{key:"jsonp",value:function(e,t){var i="jsonp_callback_"+Math.round(1e5*Math.random());window[i]=function(e){return delete window[i],document.body.removeChild(n),t(null,e)};var n=document.createElement("script");n.src=e+(e.indexOf("?")>=0?"&":"?")+"callback="+i,n.addEventListener("error",function(e){return delete window[i],t(new Error("The JSONP request was blocked. This may be the result of an invalid URL, cross origin restrictions, or the remote server may not be online."))}),document.body.appendChild(n)}},{key:"import",value:function(e,t,i,n){var r=this;if(Array.isArray(e)){var o=new Array(e.length),a=0;if(e.forEach(function(e,t){r.import(e,function(e){o[t]=e,a++},i)}),t)var s=setInterval(function(){a===e.length&&(clearInterval(s),t(o))},5)}else{var l=this.getFileExtension(e);try{var c=void 0;"js"===l?(c=document.createElement("script"),c.setAttribute("type","text/javascript"),c.setAttribute("src",e)):"css"===l&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",e)),c.onload="function"==typeof t?function(){t(c)}:function(){},document.getElementsByTagName("head")[0].appendChild(c)}catch(e){}if(!(["js","css"].indexOf((l||"").trim().toLowerCase())>=0)){if(i="boolean"==typeof i&&i,"http"!==e.substr(0,4)){var u=window.location.href.split("/");u.pop(),e=u.join("/")+"/"+e}if(!i&&this.importCache.hasOwnProperty(e))return t&&t(this.importCache[e]),void(NGN.BUS&&NGN.BUS.emit("html.import",this.importCache[e]));if(void 0!==Request&&void 0!==Response&&void 0!==Headers&&window.hasOwnProperty("fetch")&&"function"==typeof fetch){var d=new Request(e),h=new Headers,f=/^.*\:\/\/(.*)\:(.*)\@(.*)$/gi.exec(e),p={redirect:"follow"};null!==f&&(h.append("Authorization","Basic "+btoa(f[2]+":"+f[3])),e=f[1]+"://"+f[4],p.credentials="include"),p.headers=h,fetch(d,p).then(function(t){var i=t.text();return r.cacheContent(e,i,n),i}).then(function(e){"function"==typeof t&&t(e),NGN.BUS&&NGN.BUS.emit("html.import",e)}).catch(function(e){throw e})}else this.get(e,function(i){if(200!==i.status)return console.warn("Check the file path of the snippet that needs to be imported. "+e+" could not be found ("+i.status+")");var o=i.responseText;r.cacheContent(e,o,n),0===o.length&&console.warn(r.normalizeUrl(e)+" import has no content!"),NGN.isFn(t)&&t(o),NGN.BUS&&NGN.BUS.emit("html.import",o)})}}}},{key:"cacheContent",value:function(e,t,i){var n=this;this.importCache[e]=t,i>=0&&setTimeout(function(){delete n.importCache[e]},i)}},{key:"fetchRemoteFile",value:function(e,t,i,n){this.import(e,function(e){var r=new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&(clearTimeout(o),r.disconnect(),NGN.isFn(n)&&n(e.addedNodes[0]))})});r.observe(t,{attributes:!1,childList:!0,characterData:!1,subtree:!1});var o=setTimeout(function(){NGN.isFn(n)&&n(e)},750);t.insertAdjacentHTML(i,e)})}},{key:"importTo",value:function(e,t,i){this.fetchRemoteFile(e,t,"beforeend",i)}},{key:"importAfter",value:function(e,t,i){this.fetchRemoteFile(e,t,"afterend",i)}},{key:"importBefore",value:function(e,t,i){this.fetchRemoteFile(e,t,"beforebegin",i)}},{key:"template",value:function(e,t,i){var n=this;e=this.normalizeUrl(e),"function"==typeof t&&(i=t,t={}),t=t||{};var r=void 0;if(this.importCache.hasOwnProperty(e))return r=this.importCache[e],this.applyData(r,t,i);this.get(e,function(r){var o=n.getFileExtension(e);if(["js","css"].indexOf((o||"").trim().toLowerCase())>=0)return void console.warn("Cannot use a ."+o+" file as a template. Only HTML templates are supported.");n.importCache[e]=r.responseText,n.applyData(r.responseText,t,i)})}},{key:"predns",value:function(e,t){this.prelink(window.location.protocol+"//"+e,"dns-prefetch",t)}},{key:"preconnect",value:function(e,t){this.prelink(e,"preconnect",t)}},{key:"prefetch",value:function(e,t){this.prelink(e,"prefetch",t)}},{key:"subresource",value:function(e,t){this.prelink(e,"subresource",t)}},{key:"prerender",value:function(e,t){this.prelink(e,"prerender",t)}},{key:"getFileExtension",value:function(e){var t=null;try{
t=e.split("/").pop().split("?")[0].split(".").pop().toLowerCase()}catch(e){}return t}},{key:"defaultCacheExpiration",get:function(){return this._ttl},set:function(e){if(isNaN(e))throw new Error("Values for defaultCacheExpiration must be a valid integer.");var t=this._ttl;this._ttl=e<0?-1:e,this.emit("cache.ttl.change",{old:t,new:this._ttl})}}]),t}(NGN.EventEmitter),NetworkResource=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=e||{},Object.defineProperties(i,{globalHeaders:NGN.private(NGN.coalesce(e.headers,{})),globalCredentials:NGN.private(NGN.coalesce(e.credentials,{})),baseUrl:NGN.private(NGN.coalesce(e.baseUrl,e.baseurl,window.location.origin))}),i}return _inherits(t,e),_createClass(t,[{key:"setHeaders",value:function(e){this.globalHeaders=e}},{key:"setCredentials",value:function(e){if(e.hasOwnProperty("accesstoken")||e.hasOwnProperty("token"))e.accessToken=NGN.coalesce(e.accesstoken,e.token);else if(!(e.hasOwnProperty("username")&&e.hasOwnProperty("password")||e.hasOwnProperty("accessToken")))throw new Error("Invalid credentials. Must contain an access token OR the combination of a username AND password.");this.globalCredentials=e}},{key:"applyRequestSettings",value:function(e,i){var n=this;return i.url=this.prepareUrl(i.url),(this.globalCredentials.hasOwnProperty("accessToken")||this.globalCredentials.hasOwnProperty("username")&&this.globalCredentials.hasOwnProperty("password"))&&(i.withCredentials=NGN.coalesce(i.withCredentials,!0),this.globalCredentials.accessToken?i.accessToken=NGN.coalesce(i.accessToken,this.globalCredentials.accessToken):(i.username=NGN.coalesce(i.username,this.globalCredentials.username),i.password=NGN.coalesce(i.password,this.globalCredentials.password))),i.header=NGN.coalesce(i.header,{}),!i.header.hasOwnProperty("Authorization")&&(this.globalCredentials.hasOwnProperty("accessToken")||this.globalCredentials.hasOwnProperty("username")&&this.globalCredentials.hasOwnProperty("password"))&&(this.globalCredentials.accessToken?i.header.Authorization="Bearer "+this.globalCredentials.accessToken:i.header.Authorization="Basic "+btoa(this.globalCredentials.username+":"+this.globalCredentials.password),i.credentials="include"),Object.keys(this.globalHeaders).forEach(function(e){"Authorization"===e&&i.header.hasOwnProperty("Authorization")||(i.header[e]=n.globalHeaders[e])}),_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"applyRequestSettings",this).call(this,e,i)}},{key:"run",value:function(e,i,n){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this,e,this.prepareUrl(i),n)}},{key:"runSync",value:function(e,i){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"runSync",this).call(this,e,this.prepareUrl(i))}},{key:"prepareUrl",value:function(e){return e.indexOf("://")<0&&(e=this.normalizeUrl(this.baseUrl+"/"+e)),e.replace(/\/{2,5}/gi,"/").replace(/\:\/{1}/i,"://")}},{key:"headers",get:function(){return this.globalHeaders}}]),t}(Network);Network.prototype.Resource=NetworkResource,NGN.extend("NET",NGN.const(new Network)),Network=null,NetworkResource=null;var fuoc=function(){var e=document.createElement("style"),t=document.createTextNode("svg[src]{display:none}svg.loading{height:0px !important;width:0px !important}");e.appendChild(t),document.head.appendChild(e)};fuoc(),NGN.DOM=NGN.DOM||{},NGN.DOM.svg={},Object.defineProperties(NGN.DOM.svg,{_cache:NGN.private({}),swap:NGN.privateconst(function(e,t){for(var i=this,n=this,r=e.querySelectorAll("svg[src]"),o=0;o<r.length;o++)!function(e){for(var t=r[e].attributes,o=n._cache[r[e].getAttribute("src")],a=o.split(/>\s{0,100}</i)[0]+">",s=i.getAttributes(a),l=[],c=0;c<t.length;c++)"src"!==t[c].name.toLowerCase()&&l.push(t[c].name.toLowerCase()+'="'+t[c].value+'"');s.filter(function(e){return 0===l.filter(function(t){return 0===t.toLowerCase().indexOf(e.split("=")[0].toLowerCase())}).length});var u=l.concat(s);r[e].outerHTML=o.replace(a,"<svg "+u.join(" ")+">")}(o);t&&t()}),getAttributes:NGN.privateconst(function(e){var t=void 0;try{t=/<svg(\s.*=[\"\'].*?[\"\'])?>/i.exec(e)[1].trim();var i=/[\"\']\s/i.exec(t);i=null!==i?i[0]:'" ',t=t.replace(new RegExp(i,"gi"),i.replace(/\s/gi,",")).split(",")}catch(e){console.error(e)}return t=Array.isArray(t)?t:[t],t.map(function(e){var t=e.split("=");return t[0].toLowerCase()+"="+t[1]}).filter(function(e){return"src="!==e.substr(0,4)})}),applySvg:NGN.privateconst(function(e,t){var i=this;this.getSvgReferences(e).forEach(function(t){var n=new RegExp("<svg.*src=('|\")"+t+"('|\").*(svg|/|\"|')>","gi"),r=n.exec(e),o=0;if(i._cache.hasOwnProperty(t))for(;null!==r&&o<200;)!function(){var a=i._cache[t],s=a.split(/>\s{0,100}</i)[0]+">",l=i.getAttributes(s),c=i.getAttributes(r[0]);l=l.filter(function(e){return 0===c.filter(function(t){return 0===t.toLowerCase().indexOf(e.split("=")[0].toLowerCase())}).length});var u=c.concat(l);a=a.replace(s,"<svg "+u.join(" ")+">"),e=e.replace(r[0],a),r=n.exec(e),o++}();else console.warn("Invalid SVG content for "+t)}),t(e)}),id:NGN.privateconst(function(e){return e.replace(/.*\:\/\/|[^A-Za-z0-9]|www/gi,"")}),cleanCode:NGN.privateconst(function(e){try{return e.toString().trim().replace(/(\r\n|\n|\r)/gm,"").replace(/\s+/g," ").match(/\<svg.*\<\/svg\>/gim,"")[0]}catch(e){return""}}),viewbox:NGN.privateconst(function(e){return/(viewbox=["'])(.*?)(["'])/gim.exec(e.toString().trim())[2]||"0 0 100 100"}),cache:NGN.private(function(e,t){this._cache[e]=t}),fetchFile:NGN.private(function(e,t){if(t)if(NGN.nodelike&&0!==e.indexOf("http")&&void 0===window){var i="";try{i=require("fs").readFileSync(require("path").resolve(e).replace("file://","")).toString()}catch(t){try{i=require("fs").readFileSync(require("path").resolve(__dirname,e).replace("file://","")).toString()}catch(e){}}t(i)}else{var n=this;NGN.NET.get(e,function(i){NGN.isFn(t)&&t(200===i.status?i.responseText.indexOf("<svg")<0?new Error(e+" does not contain valid SVG content."):n.cleanCode(i.responseText):new Error(i.responseText))})}}),getSvgReferences:NGN.privateconst(function(e){for(var t=/<svg.*\/(svg>|>)/gim,i=[],n=t.exec(e);null!==n;){e=e.replace(new RegExp(n[0],"gim"),"");var r=/src=(\'|\")(.*)(\'|\")/i.exec(n[0])[2].split(" ")[0].replace(/\"|\'/gi,"");i.indexOf(r)<0&&i.push(r),t.exec(e),n=t.exec(e)}return i}),precache:NGN.privateconst(function(e,t){var i=this,n=e.length;if(e.forEach(function(e){i.fetchFile(e,function(t){t instanceof Error||i.cache(e,t),n--})}),0===n)return t();var r=setInterval(function(){0===n&&(clearInterval(r),t())},5)}),update:NGN.const(function(e,t){var i=this;if("function"==typeof e?(t=e,e=document.body):e=e||document.body,"string"==typeof e){var n=this.getSvgReferences(e).filter(function(e){return!i._cache[e]});return void this.precache(n,function(){i.applySvg(e,t)})}"#text"!==e.nodeName&&(e=!0===e.hasOwnProperty("length")?NGN.splice(e):[e],e.forEach(function(e){for(var n=e.querySelectorAll("svg[src]"),r=[],o=0;o<n.length;o++)i.getSvgReferences(n[o].outerHTML).forEach(function(e){!i._cache[e]&&r.indexOf(e)<0&&r.push(e)});i.precache(r,function(){i.swap(e,t)})}))})}),NGN.Task=function(){return function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperties(i,{name:NGN.const(NGN.coalesce(e.name,"Unknown")),callback:NGN.privateconst(e.callback),number:NGN.const(parseInt(e.number,10)),timer:NGN.private(null),_status:NGN.private(null),bus:NGN.private(e.buz),_skip:NGN.private(!1)}),i.on("timeout",function(){i._status="timedout"}),i.on("skip",function(){i._status="skipped"}),i}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e){if(this.skipped)return this.emit("skip",this),void(e&&"dev"===e&&console.warn("SKIPPED "+this.name));this.emit("start",this),e&&"dev"===e&&console.info("Executing "+this.name+":"),this._status="running";var t=this,i={name:this.name,number:this.number,timeout:function(e){t.timer=setTimeout(function(){t.emit("timeout",t)},e)}};this.callback.apply(i,[function(){t._status="complete",t.emit("complete",t)}]),0===this.callback.length&&(t._status="complete",t.emit("complete",t))}},{key:"skip",value:function(){"running"===this._status?console.warn("Cannot skip step: "+this.name+" is currently running."):"timedout"===this._status?console.warn("Cannot skip step: "+this.name+" timed out."):"complete"===this._status&&console.warn("Cannot skip step: "+this.name+" already completed."),this._skip=!0}},{key:"status",get:function(){return this._status}},{key:"skipped",get:function(){return this._skip}}]),t}(NGN.EventEmitter)},NGN.Task=NGN.Task(),NGN.nodelike&&(module.exports=NGN.Task),NGN.Tasks=function(){return function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"production";_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(i,{steps:NGN.private([]),completed:NGN.private(0),timeout:NGN.private(null),_mode:NGN.private(e),_cancel:NGN.private(!1),processing:NGN.private(!1),timer:NGN.private(null),sequential:NGN.private(!1)}),i.on("taskcomplete",function(e){i.sequential||"completed"===e.status||(e._status="complete",i.completed++,"dev"===i.mode&&console.info(e.name+" completed."),i.completed===i.steps.length&&(i.processing=!1,Object.keys(i.steps).forEach(function(e){clearTimeout(i.steps[e].timer)}),i.emit("complete")))}),i.on("aborting",function(){i._cancel=!0}),i}return _inherits(t,e),_createClass(t,[{key:"onTimeout",value:function(){var e=[];this.steps.length>0&&this.steps.forEach(function(t){e.push(t.name,null===t.status?"NOT STARTED":t.status)}),this.emit("timeout",{process:e}),e=null}},{key:"add",value:function(e,t){var i=this;if(this.processing)return console.warn("Cannot add a step while processing.");if("function"==typeof e&&(t=e,e="Step "+(parseInt(this.steps.length)+1)),"function"!=typeof t)throw new Error("No processing method defined for step "+(parseInt(this.steps.length)+1)+".");var n=new NGN.Task({name:e,callback:t,number:(this.steps.length>0?this.steps[this.steps.length-1].number:0)+1});n.on("complete",function(e){return i.emit("taskcomplete",e)}),n.on("timeout",function(e){"running"!==e.status&&"timedout"!==e.status||i.emit("tasktimeout",e)}),this.steps.push(n),this.emit("taskcreate",n)}},{key:"getAt",value:function(e){return this.steps[e]}},{key:"get",value:function(e){var t=this.steps.filter(function(t){return t.name===e});return 1===t.length?t[0]:(t=this.steps.filter(function(t){return t.number===e}),1===t.length?t[0]:void 0)}},{key:"remove",value:function(e){if(this.processing)return console.warn("Cannot add a step while processing.");var t=this.steps.filter(function(t){return t.name===e});return 1===t.length?(this.steps=this.steps.filter(function(t){return t.name!==e}),this.emit("taskremove",t[0]),t[0]):(t=this.steps.filter(function(t){return t.number===e}),1===t.length?(this.steps=this.steps.filter(function(t){return t.number!==e}),this.emit("taskremove",t[0]),t[0]):void 0)}},{key:"removeAt",value:function(e){return this.processing?console.warn("Cannot add a step while processing."):"number"!=typeof e?console.error("Failed to remove step: "+e):e<0||e>=this.steps.length?console.error("Step index "+e+" could not be found or does not exist."):this.steps.splice(e,1)[0]}},{key:"reset",value:function(){if(this.processing)return console.warn("Cannot reset a running queue. Abort or wait for the process to complete before resetting.");this.steps.forEach(function(e){e._skip=!1})}},{key:"process",value:function(e){var t=this;if(this.processing)return console.warn("Cannot start processing (already running). Please wait for this process to complete before calling process() again.");if(0===this.steps.length)return this.emit("complete");if(this.processing=!0,this._cancel=!1,null!==this.timeout&&(this.timer=setTimeout(function(){return t.onTimeout()},this.timeout)),this.sequential="boolean"==typeof e&&e,this.sequential){var i=this.steps,n=new NGN.EventEmitter;n.on("taskcomplete",function(){if(i.length>0){var e=i.shift();if(e.skipped)return n.emit("taskcomplete");e.on("complete",function(){return n.emit("taskcomplete")}),e.on("start",function(){return t.emit("taskstart",e)}),e.run(t.mode)}else t.emit("complete")});var r=i.shift();r.on("complete",function(){return n.emit("taskcomplete")}),r.on("start",function(){return t.emit("taskstart",r)}),r.run(this.mode)}else for(var o=0;o<this.steps.length;o++)this.steps[o].run(this.mode)}},{key:"run",value:function(){this.process.apply(this,arguments)}},{key:"abort",value:function(){var e=this;this.emit("aborting"),this.each(function(e){["completed","running","timedout"].indexOf(e.status)<0&&!e.skipped&&e.skip()}),this.once("complete",function(){return e.emit("aborted")})}},{key:"each",value:function(e){for(var t=0;t<this.steps.length;t++)e(this.steps[t])}},{key:"cancel",value:function(){this.abort.apply(this,arguments)}},{key:"list",get:function(){return this.steps.map(function(e){return{id:e.number,name:e.name,status:e.status}})}},{key:"mode",get:function(){return this._mode},set:function(e){"dev"===e.toLowerCase().substr(0,3)?this._mode="dev":this._mode="production"}},{key:"cancelled",get:function(){return this._cancel}}]),t}(NGN.EventEmitter)},NGN.Tasks=NGN.Tasks(),NGN.nodelike&&(module.exports=NGN.Tasks),NGN.DATA=NGN.DATA||{},NGN.DATA.util={},Object.defineProperties(NGN.DATA.util,{crcTable:NGN.private(null),makeCRCTable:NGN.privateconst(function(){for(var e=void 0,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}),checksum:NGN.const(function(e){for(var t=this.crcTable||(this.crcTable=this.makeCRCTable()),i=-1,n=0;n<e.length;n++)i=i>>>8^t[255&(i^e.charCodeAt(n))];return(-1^i)>>>0}),GUID:NGN.const(function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&o]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255]})});var NgnDataModel=function(_NGN$EventEmitter4){function NgnDataModel(e){_classCallCheck(this,NgnDataModel),e=e||{};var t=_possibleConstructorReturn(this,(NgnDataModel.__proto__||Object.getPrototypeOf(NgnDataModel)).call(this));if(Object.defineProperties(t,{idAttribute:NGN.privateconst(e.idAttribute||"id"),fields:NGN.private(e.fields||{id:{required:!0,type:String,default:e.id||null}}),hiddenFields:NGN.private(NGN.coalesce(e.metaFields)),joins:NGN.private(e.relationships||{}),virtuals:NGN.private(e.virtuals||{}),validators:NGN.private({}),validation:NGN.public(NGN.coalesce(e.validation,!0)),isNew:NGN.private(!0),isRecordDestroyed:NGN.private(!1),oid:NGN.private(e[t.idAttribute]||null),autoid:NGN.public(NGN.coalesce(e.autoid,!1)),autoidPrefix:NGN.public(NGN.coalesce(e.autoidPrefix)),autoidPostfix:NGN.public(NGN.coalesce(e.autoidPostfix)),benchmark:NGN.private(null),expiration:NGN.private(null),expirationTimeout:NGN.private(null),hasExpired:NGN.private(!1),ignoreTTL:NGN.private(!1),createDate:NGN.privateconst(Date.now()),setUnmodified:NGN.privateconst(function(){this.benchmark=this.checksum,this.changelog=[]}),allowInvalidSave:NGN.private(NGN.coalesce(e.allowInvalidSave,!1)),disableDataValidation:NGN.private(NGN.coalesce(e.disableDataValidation,!1)),invalidDataAttributes:NGN.private([]),initialDataAttributes:NGN.private([]),changelog:NGN.private([]),_nativeValidators:NGN.privateconst({min:function(e,t){return"array"===NGN.typeof(t)?t.length>=e:"number"===NGN.typeof(t)?t>=e:"string"===NGN.typeof(t)?t.trim().length>=e:"date"===NGN.typeof(t)&&t.parse()>=e.parse()},max:function(e,t){return"array"===NGN.typeof(t)?t.length<=e:"number"===NGN.typeof(t)?t<=e:"string"===NGN.typeof(t)?t.trim().length<=e:"date"===NGN.typeof(t)&&t.parse()<=e.parse()},enum:function(e,t){return e.indexOf(t)>=0},required:function(e,i){return t.hasOwnProperty(e)&&null!==t[i]}}),_dataMap:NGN.private(e.dataMap||null),_reverseDataMap:NGN.public(null),raw:NGN.private({}),rawjoins:NGN.private({}),_store:NGN.private(null),_proxy:NGN.private(e.proxy||null),proxyignore:NGN.private(NGN.coalesce(e.proxyignore,!1))}),"id"===NGN.coalesce(t.idAttribute,"")||t.fields.hasOwnProperty(t.idAttribute)||console.warn(t.idAttribute+" is specified as the ID, but it is not defined in the fields."),e.proxy){if(!(t._proxy instanceof NGN.DATA.Proxy))throw new Error("Invalid proxy configuration.");t._proxy.init(t)}var i=t.datafields.concat(t.virtualdatafields).concat(t.relationships).filter(function(e,t,i){return i.indexOf(e)!==t});if(i.length>0)throw new Error("Duplicate field names exist: "+i.join(", ")+". Unique fieldnames are required for data fields, virtuals, and relationship fields.");t.fields.hasOwnProperty("id")||(e.fields.id={required:!0,type:String,default:e.id||null}),Object.keys(t.fields).forEach(function(e){"object"!==_typeof(t.fields[e])&&null!==t.fields[e]&&(t.fields[e]={required:!0,type:t.fields[e],default:null,name:e}),t.addField(e,!0)}),t.hiddenFields&&Object.keys(t.hiddenFields).forEach(function(e){t.addMetaField(e,NGN.coalesce(t.hiddenFields[e],null),!0)}),Object.keys(t.virtuals).forEach(function(e){Object.defineProperty(t,e,NGN.get(function(){return t.virtuals[e].apply(t)}))}),Object.keys(t.joins).forEach(function(e){t.addRelationshipField(e,t.joins[e],!0)});var n=["field.update","field.create","field.remove","field.invalid","validator.add","validator.remove","relationship.create","relationship.remove","expired","deleted","reset","load"];return NGN.BUS&&n.forEach(function(e){t.on(e,function(){var t=NGN.slice(arguments);t.push(this),t.unshift(e),NGN.BUS.emit.apply(NGN.BUS,t)})}),e.hasOwnProperty("expires")&&(t.expires=e.expires),t.on("changelog.append",function(e){e.id=NGN.DATA.util.GUID(),t.changelog.push(e),t.emit("append.changelog",e)}),t.on("changelog.remove",function(e){e=Array.isArray(e)?e:[e],t.emit("remove.changelog",e)}),t}return _inherits(NgnDataModel,_NGN$EventEmitter4),_createClass(NgnDataModel,[{key:"expire",value:function(e){if(!this.expired)return e?void(this.expires=e):void(this.ignoreTTL||(this.hasExpired=!0,clearTimeout(this.expirationTimeout),this.emit("expired",this)))}},{key:"disableExpiration",value:function(){this.expires=-1}},{key:"addValidator",value:function(e,t){if(!this.hasOwnProperty(e))return void console.warn("No validator could be create for %c"+e+"%c. It is not an attribute of %c"+this.type+"%c.",NGN.css,"",NGN.css,"");switch(void 0===t?"undefined":_typeof(t)){case"function":this.validators[e]=this.validators[e]||[],this.validators[e].push(t),this.emit("validator.add",e);break;case"object":Array.isArray(t)?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.indexOf(e)>=0}),this.emit("validator.add",e)):t.test?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.test(e)}),this.emit("validator.add",e)):console.warn("No validator could be created for %c"+e+"%c. The validator appears to be invalid.",NGN.css,"");break;case"string":case"number":case"date":this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return e===t}),this.emit("validator.add",e);break;default:console.warn("No validator could be create for %c"+e+"%c. The validator appears to be invalid.",NGN.css,"")}}},{key:"removeValidator",value:function(e){this.validators.hasOwnProperty(e)&&(delete this.validators[e],this.emit("validator.remove",e))}},{key:"validate",value:function(e){if(!this.validation)return!0;var t=this;if(e){if(this.validators.hasOwnProperty(e)){for(var i=0;i<this.validators[e].length;i++){if(!t.validators[e][i].apply(t,[t[e]]))return t.invalidDataAttributes.indexOf(e)<0&&t.invalidDataAttributes.push(e),!1;t.invalidDataAttributes=t.invalidDataAttributes.filter(function(t){return e!==t})}if(!this.validateDataType(e))return this.invalidDataAttributes.push(e),!1}return!0}this.datafields.forEach(function(e){t.validate(e)})}},{key:"validateDataType",value:function(e){var t=NGN.typeof(this[e]),i=NGN.typeof(this.fields[e].type);return"null"!==t?t===i:null!==this[e]||!this.fields[e].required||!(!this.autoid||e!==this.idAttribute)}},{key:"getRelationshipField",value:function(e){return this.joins[e]}},{key:"hasRelationship",value:function(e){return this.joins.hasOwnProperty(e)}},{key:"getDataField",value:function(e){return this.fields[e]}},{key:"getMappedFieldName",value:function(e){return this.dataMap&&this.dataMap.hasOwnProperty(e)?this.dataMap[e]:e}},{key:"getReverseMappedFieldName",value:function(e){return this.reverseMap&&this.reverseMap.hasOwnProperty(e)?this.reverseMap[e]:e}},{key:"hasDataField",value:function(e){return this.fields.hasOwnProperty(e)}},{key:"hasMetaField",value:function(e){return!!this.has(e)&&this.getDataField(e).hidden}},{key:"has",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!(this.idAttribute===e||this.hasDataField(e)||this.hasRelationship(e)||t&&this.hasVirtualField(e))}},{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e||this.raw,n={};for(var r in i)if(i.nonEnumerableProperties=i.nonEnumerableProperties||"",this.fields.hasOwnProperty(r)&&!this.hasMetaField(r)&&(r="id"===r?this.idAttribute:r,i.hasOwnProperty(r)&&i.nonEnumerableProperties.indexOf(r)<0&&/^[a-z0-9 ]$/.test(r.substr(0,1))||void 0!==i[r]&&i.enumerableProperties.indexOf(r)>=0)){var o=Object.getOwnPropertyDescriptor(i,r);if(!o.set)switch(_typeof(o.value)){case"function":"Date"===o.value.name?n[r]=i[r].refs.toJSON():"RegExp"===o.value.name&&(n[r]=o.value());break;case"object":i[r]instanceof Array&&!Array.isArray(i[r])&&(i[r]=i[r].slice(0)),n[r]=i[r];break;default:n[r]=NGN.coalesce(i[r],this.fields[r].default,null)}}var a=this;return this.relationships.forEach(function(e){n[e]=a.rawjoins[e].data}),(n.hasOwnProperty(this.idAttribute)&&t||n.hasOwnProperty(this.idAttribute)&&void 0===n[this.idAttribute])&&delete n[this.idAttribute],n}},{key:"addField",value:function addField(field){var fieldcfg=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,suppressEvents=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"boolean"==typeof fieldcfg&&(suppressEvents=fieldcfg,fieldcfg=null);var me=this,cfg=null;if("id"!==field.toLowerCase()){if("object"===(void 0===field?"undefined":_typeof(field))){if(!field.name)throw new Error("Cannot create data field. The supplied configuration does not contain a unique data field name.");cfg=field,field=cfg.name,delete cfg.name}if(void 0!==me[field]){try{var source=NGN.stack.pop();console.warn("%c"+field+"%c data field defined multiple times (at %c"+source.path+"%c). Only the last defintion will be used.",NGN.css,"",NGN.css,"")}catch(e){console.warn("%c"+field+"%c data field defined multiple times. Only the last definition will be used.",NGN.css,"",NGN.css,"")}delete me[field]}if(me.fields[field]=NGN.coalesce(cfg,fieldcfg,me.fields[field],{}),me.fields[field].required=NGN.coalesce(me.fields[field].required,!1),!me.fields[field].hasOwnProperty("type")&&me.fields[field].hasOwnProperty("default")){var type=NGN.typeof(me.fields[field].default);type=type.charAt(0).toUpperCase()+type.slice(1),me.fields[field].type=eval(type)}if(me.fields[field].type=NGN.coalesce(me.fields[field].type,String),field===me.idAttribute&&!0===me.autoid?(me.fields[field].type=String,me.fields[field].default=NGN.coalesce(me.autoidPrefix,"")+NGN.DATA.util.GUID()+NGN.coalesce(me.autoidPostfix,"")):me.fields[field].default=NGN.coalesce(me.fields[field].default),me.fields[field].hidden=NGN.coalesce(me.fields[field].hidden,!1),me.raw[field]=me.fields[field].default,me[field]=me.raw[field],Object.defineProperty(me,field,{get:function(){return NGN.coalesce(me.raw[field],me.fields[field].default,null)},set:function(e){var t=me.raw[field];if(t!==e){var i=!me.validate(field);me.raw[field]=e;var n={action:"update",field:field,old:t,new:me.raw[field]};this.emit("changelog.append",n),this.emit("field.update",n),this.emit("field.update."+field,n),me.validate(field)?i&&me.emit("field.valid",{field:field}):me.emit("field.invalid",{field:field})}}}),!suppressEvents){var c={action:"create",field:field};this.emit("changelog.append",c),this.emit("field.create",c)}if(me.fields.hasOwnProperty(field)&&(me.fields[field].hasOwnProperty("pattern")&&me.addValidator(field,me.fields[field].pattern),["min","max","enum"].forEach(function(e){me.fields[field].hasOwnProperty(e)&&me.addValidator(field,function(t){return me._nativeValidators[e](me.fields[field][e],t)})}),me.fields[field].hasOwnProperty("required")&&me.fields[field].required&&me.addValidator(field,function(e){return me._nativeValidators.required(field,e)}),me.fields[field].hasOwnProperty("validate")))if("function"==typeof me.fields[field].validate)me.addValidator(field,function(e){return me.fields[field].validate.apply(me,[e])});else{var _source=NGN.stack.pop();console.warn("Invalid custom validation function (in %c"+_source.path+"%c). The value passed to the validate attribute must be a function.",NGN.css,"")}}else null===me.id&&me.autoid&&(me.id=NGN.coalesce(me.autoidPrefix,"")+NGN.DATA.util.GUID()+NGN.coalesce(me.autoidPostfix,""))}},{key:"addMetaField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.has(e)||(this.hiddenFields=NGN.coalesce(this.hiddenFields,{}),this.hiddenFields[e]=t,this.addField.apply(this,arguments),this.fields[e].hidden=!0)}},{key:"addVirtual",value:function(e,t){var i=this;Object.defineProperty(this,e,{get:function(){return t.apply(i)}})}},{key:"addRelationshipField",value:function(e,t,i){if(i=void 0!==i&&i,this.rawjoins.hasOwnProperty(e)||this.fields.hasOwnProperty(e)||this.hasOwnProperty(e))throw new Error(e+" already exists. It cannot be added to the model again.");if(("function"==typeof t||"object"===(void 0===t?"undefined":_typeof(t))&&!t.hasOwnProperty("type"))&&(t={type:t}),!t.type)throw new Error("Configuration has no reference! The reference must be an NGN.DATA.Model or NGN.DATA.Store.");t.required=NGN.coalesce(t.required,!0),t.default=t.default||null,this.joins.hasOwnProperty(e)||(this.joins[e]=t);var n=this,r="model";if(t.type instanceof NGN.DATA.Store)r="store";else if("array"===NGN.typeof(t.type)){if(0===t.type.length)throw new Error(e+" cannot be an empty store. A model must be provided.");r="collection"}else"object"===_typeof(t.type)&&t.type.model&&(r="store");if("store"===r){var o={};if(t.type instanceof NGN.DATA.Store)this.rawjoins[e]=t.type,o=null;else{if(!t.type.model)throw new Error("Nested store configuration is invalid or was not recognized.");o=t.type}null!==o&&(this.rawjoins[e]=new NGN.DATA.Store(o)),this.applyStoreMonitor(e)}else if("collection"===r)this.rawjoins[e]=new NGN.DATA.Store({model:t.type[0]}),this.applyStoreMonitor(e);else if(t.type.data){if(!t.type.data)throw new Error("Nested store configuration is invalid or was not recognized.");this.rawjoins[e]=t.type,this.applyStoreMonitor(e)}else this.rawjoins[e]=null!==t.default?new t.type(t.default):new t.type,this.applyModelMonitor(e);if(Object.defineProperty(this,e,{enumerable:!0,get:function(){return n.rawjoins[e]}}),!i){var a={action:"create",field:e};this.emit("changelog.append",a),this.emit("relationship.create",a)}}},{key:"applyModelMonitor",value:function(e){var t=this.rawjoins[e],i=this,n=t.data;t.on("load",function(){var r={action:"update",field:e,old:NGN.coalesce(n),new:t.data,join:!0,originalEvent:{event:"load",record:t}};n=t.data,i.emit("field.update",r),i.emit("field.update."+e,r)}),t.on("field.update",function(n){var r={action:"update",field:e+"."+n.field,old:n.old,new:n.new,join:!0,originalEvent:{event:"field.update",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.create",function(n){var r={action:"update",field:e+"."+n.field,old:null,new:null,join:!0,originalEvent:{event:"field.create",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.remove",function(n){var r={action:"update",field:e+"."+n.field,old:n.value,new:null,join:!0,originalEvent:{event:"field.remove",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.invalid",function(t){i.emit("field.invalid"),i.emit("field.invalid."+e+"."+t.field)}),t.on("field.valid",function(t){i.emit("field.valid"),i.emit("field.valid."+e+"."+t.field)})}},{key:"applyStoreMonitor",value:function(e){if(this.rawjoins.hasOwnProperty(e)&&this.rawjoins[e]instanceof NGN.DATA.Store){var t=this;this.rawjoins[e].on("record.create",function(i){var n=t[e].data;n.pop();var r={action:"update",field:e,join:!0,old:n,new:t[e].data,originalEvent:{event:"record.create",record:i}};t.emit("field.update",r),t.emit("field.update."+e,r)}),this.rawjoins[e].on("record.update",function(i,n){if(n){var r={action:"update",field:e+"."+n.field,join:!0,old:n.old,new:n.new,originalEvent:{event:"record.update",record:i}};t.emit("field.update",r),t.emit("field.update."+e+"."+n.field,r)}}),this.rawjoins[e].on("record.delete",function(i){var n=t[e].data;n.push(i.data);var r={action:"update",field:e,join:!0,old:n,new:t[e].data,originalEvent:{event:"record.delete",record:i}};t.emit("field.update",r),t.emit("field.update."+e,r)}),this.rawjoins[e].on("record.invalid",function(i){t.emit("field.invalid",i.field),t.emit("field.invalid."+e,i.field)}),this.rawjoins[e].on("record.valid",function(i){t.emit("field.valid",i.field),t.emit("field.valid."+e,i.field)})}}},{key:"removeField",value:function(e){if(this.raw.hasOwnProperty(e)){var t=this.raw[e];delete this[e],delete this.fields[e],delete this.raw[e],this.invalidDataAttributes.indexOf(e)>=0&&this.invalidDataAttributes.splice(this.invalidDataAttributes.indexOf(e),1);var i={action:"delete",field:e,value:t};this.emit("field.remove",i),this.emit("changelog.append",i)}}},{key:"removeVirtual",value:function(e){delete this[e]}},{key:"removeRelationshipField",value:function(e,t){if(t=void 0!==t&&t,this.joins.hasOwnProperty(e)){var i=this.rawjoins[e];if(delete this.rawjoins[e],delete this[e],delete this.joins[e],!t){var n={action:"delete",field:e,old:i,join:!0};this.emit("changelog.append",n),this.emit("relationship.remove",n)}}}},{key:"hasVirtualField",value:function(e){return this.virtuals.hasOwnProperty(e)}},{key:"setSilent",value:function(e,t){return e===this.idAttribute?void(this.id=t):this.hasRelationship(e)?this[e]instanceof NGN.DATA.Store?(this[e].clear(),void this[e].bulk(null,t)):void this[e].load(t):void(this.raw[e]=t)}},{key:"undo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.changelog.splice(this.changelog.length-e,e),i=this;t.reverse().forEach(function(e){if("boolean"==typeof e.join&&e.join)switch(e.action){case"create":i.removeRelationshipField(e.field);break;case"delete":i.addRelationshipField(e.field),i[e.field]=e.old}else switch(e.action){case"update":i[e.field]=e.old;break;case"create":i.removeField(e.field);break;case"delete":i.addField(e.field),i[e.field]=i.old}}),this.emit("changelog.remove",t.map(function(e){return e.id}))}},{key:"load",value:function(e){var t=this;e=e||{},null!==this._dataMap&&Object.keys(this.reverseMap).forEach(function(i){e.hasOwnProperty(i)&&(e[t.reverseMap[i]]=e[i],delete e[i])}),Object.keys(e).forEach(function(i){if(t.hasDataField(i))t.raw.hasOwnProperty(i)?t.raw[i]=e[i]:i===t.idAttribute&&(t.id=e[i]);else if(t.hasRelationship(i))t.rawjoins[i].load(e[i]);else if(i!==t.idAttribute&&!t.hasMetaField(i))try{var n=NGN.stack.pop();console.warn("%c"+i+"%c specified in %c"+n.path+"%c as a data field but is not defined in the model.",NGN.css,"",NGN.css,"")}catch(e){console.warn("%c"+i+"%c specified as a data field but is not defined in the model.",NGN.css,"")}}),this.setUnmodified(),this.emit("load")}},{key:"proxy",get:function(){
return this._proxy},set:function(e){!this._proxy&&e instanceof NGN.DATA.Proxy&&(this._proxy=e,this._proxy.init(this))}},{key:"deleted",get:function(){return this.isRecordDestroyed}},{key:"isDestroyed",set:function(e){if("boolean"!=typeof e)throw console.warn(NGN.stack),new Error("Invalid data type. isDestroyed must be a boolean. Received "+(void 0===e?"undefined":_typeof(e)));this.isRecordDestroyed=e,e&&this.emit("deleted")}},{key:"expires",get:function(){return this.expiration},set:function(e){var t=this;if("date"===NGN.typeof(e)||"number"===NGN.typeof(e)){if(clearTimeout(this.expirationTimeout),"number"===NGN.typeof(e)){if(e<0)return void(this.ignoreTTL=!0);var i=new Date;e=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()+e)}if(this.ignoreTTL=!1,this.expiration=e,Date.now()>=this.expiration.getTime())return void this.expire();this.hasExpired=!1;var n=this.expiration.getTime()-Date.now();this.expirationTimeout=setTimeout(function(){t.expire()},n)}else try{var r=NGN.stack.pop();console.warn("Expiration could not be set at %c"+r.path+"%c (Invalid data type. Must be a Date or number).",NGN.css,"")}catch(e){console.warn("Expiration could not be set (Invalid data type. Must be a Date or number).")}}},{key:"expired",get:function(){return!this.ignoreTTL&&this.hasExpired}},{key:"modified",get:function(){return this.checksum!==this.benchmark}},{key:"id",get:function(){return this.oid},set:function(e){this.oid=e}},{key:"checksum",get:function(){return NGN.DATA.util.checksum(JSON.stringify(this.data))}},{key:"dataMap",get:function(){return this._dataMap},set:function(e){this._dataMap=e,this._reverseDataMap=null}},{key:"datastore",get:function(){return this._store}},{key:"valid",get:function(){return this.validate(),0===this.invalidDataAttributes.length}},{key:"datafields",get:function(){if(!this.hiddenFields)return Object.keys(this.fields);var e=NGN.coalesce(this.hiddenFields,{});return Object.keys(this.fields).filter(function(t){return!e.hasOwnProperty(t)})}},{key:"relationships",get:function(){return Object.keys(this.joins)}},{key:"virtualdatafields",get:function(){return Object.keys(this.virtuals)}},{key:"reverseMap",get:function(){if(null!==this.dataMap){if(null!==this._reverseDataMap)return this._reverseDataMap;var e={},t=this;return Object.keys(this._dataMap).forEach(function(i){e[t._dataMap[i]]=i}),this._reverseDataMap=e,e}return null}},{key:"data",get:function(){var e=this.serialize();if(!e.hasOwnProperty(this.idAttribute)&&this.autoid&&(e[this.idAttribute]=this[this.idAttribute]),this.dataMap){var t=this;Object.keys(this.dataMap).forEach(function(i){e.hasOwnProperty(i)&&(e[i]instanceof NGN.DATA.Model?e[t.dataMap[i]]=e[i].data:e[t.dataMap[i]]=e[i],delete e[i])})}return e}},{key:"representation",get:function(){var e=this,t=this.data;return Object.keys(this.rawjoins).forEach(function(i){t[i]=e.rawjoins[i].representation}),Object.keys(this.virtuals).forEach(function(i){var n=e[i];n instanceof NGN.DATA.Entity||n instanceof NGN.DATA.Store?t[i]=e[i].representation:"function"!=typeof n&&(t[i]=e[i])}),t}},{key:"history",get:function(){return this.changelog.reverse()}}]),NgnDataModel}(NGN.EventEmitter);NGN.DATA=NGN.DATA||{},Object.defineProperties(NGN.DATA,{Model:NGN.const(function(e){return function(t){var i=new NgnDataModel(e);return t&&i.load(t),i}}),Entity:NGN.private(NgnDataModel)}),NGN.nodelike&&(module.exports=NGN.DATA);var NgnDataStore=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(Object.defineProperties(i,{_model:{enumerable:!1,writable:!0,configurable:!1,value:NGN.coalesce(e.model)},_data:NGN.private([]),_filters:NGN.private([]),_index:NGN.private(e.index||[]),_created:NGN.private([]),_deleted:NGN.private([]),_loading:NGN.private(!1),_softarchive:NGN.private([]),_proxy:NGN.private(e.proxy||null),allowDuplicates:NGN.public(NGN.coalesce(e.allowDuplicates,!0)),errorOnDuplicate:NGN.const(NGN.coalesce(e.errorOnDuplicate,e.allowDuplicates,!0)),autoRemoveExpiredRecords:NGN.privateconst(NGN.coalesce(e.autoRemoveExpiredRecords,!0)),softDelete:NGN.privateconst(NGN.coalesce(e.softDelete,!1)),softDeleteTtl:NGN.private(NGN.coalesce(e.softDeleteTtl,-1)),fifo:NGN.private(NGN.coalesce(e.FIFO,-1)),lifo:NGN.private(NGN.coalesce(e.LIFO,-1)),maxRecords:NGN.private(NGN.coalesce(e.maxRecords,-1)),minRecords:NGN.private(NGN.coalesce(e.minRecords,0)),snapshotarchive:NGN.private(null)}),i.lifo>0&&i.fifo>0)throw new Error("NGN.DATA.Store can be configured as FIFO or LIFO, but not both simultaneously.");i.lifo>0||i.fifo>0?(i.minRecords=0,i.maxRecords=-1):i.minRecords=i.minRecords<0?0:i.minRecords;var n={};i._index.forEach(function(e){n[e]=[]}),i._index=n;var r=["record.duplicate","record.create","record.update","record.delete","record.restored","record.purged","record.move","record.invalid","record.valid","clear","filter.create","filter.delete","index.create","index.delete"];if(NGN.BUS&&r.forEach(function(e){i.on(e,function(){var t=NGN.slice(arguments);t.shift(),t.push(this),NGN.BUS.emit(e,t)})}),e.proxy){if(!(i._proxy instanceof NGN.DATA.Proxy))throw new Error("Invalid proxy configuration.");i._proxy.init(i)}return i}return _inherits(t,e),_createClass(t,[{key:"replaceModel",value:function(e){this._model=e}},{key:"add",value:function(e,t){var i=void 0;if(this.maxRecords>0&&this._data.length+1>this.maxRecords)throw new Error("Maximum record count exceeded.");if(e instanceof NGN.DATA.Entity)i=e;else{try{e=JSON.parse(e)}catch(e){}if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Cannot add a non-object record.");i=this.model?new this.model(e):e}if(i.hasOwnProperty("_store")&&(i._store=this),!this.isDuplicate(i)||(this.emit("record.duplicate",i),this.allowDuplicates))return this.lifo>0&&this._data.length+1>this.lifo?this.remove(this._data.length-1):this.fifo>0&&this._data.length+1>this.fifo&&this.remove(0),this.listen(i),this.applyIndices(i,this._data.length),this._data.push(i),!this._loading&&this._created.indexOf(i)<0&&this._created.push(i),NGN.coalesce(t,!1)||this.emit("record.create",i),i.valid||this.emit("record.invalid",i),i;if(this.errorOnDuplicate)throw new Error("Cannot add duplicate record (allowDuplicates = false).")}},{key:"insertBefore",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.insert(e,t,i,"before")}},{key:"insertAfter",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.insert(e+1,t,i,"after")}},{key:"insert",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"after",r=this.add(t,!0);return r&&(this.move(this._data.length-1,e,n,!1),i||this.emit("record.create",r)),r}},{key:"isDuplicate",value:function(e){return!(this._data.indexOf(e)>=0)&&this._data.filter(function(t){return t.checksum===e.checksum}).length>0}},{key:"listen",value:function(e){var t=this;e.on("field.update",function(i){t.updateIndice(i.field,i.old,i.new,t._data.indexOf(e)),t.emit("record.update",e,i)}),e.on("field.delete",function(i){t.updateIndice(i.field,i.old,void 0,t._data.indexOf(e)),t.emit("record.update",e,i)}),e.on("field.invalid",function(){t.emit("record.invalid",e)}),e.on("field.valid",function(){t.emit("record.valid",e)}),e.on("expired",function(){e.expired&&(t.emit("record.expired",e),t.autoRemoveExpiredRecords)&&t.indexOf(e)>=0&&t.remove(e)})}},{key:"bulk",value:function(e,t){var i=this;this._loading=!0;var n=[];t.forEach(function(e){n.push(i.add(e,!0))}),this._loading=!1,this._deleted=[],this._created=[],null!==e?setTimeout(function(){i.emit(e||"load",n),n=null},100):n=null}},{key:"load",value:function(){var e=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("load",e)}},{key:"reload",value:function(e){this.clear();var t=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("reload",t)}},{key:"indexOf",value:function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&(e instanceof NGN.DATA.Entity||e.checksum)?this._data.findIndex(function(t){return t.checksum===e.checksum}):-1}},{key:"contains",value:function(e){return this.indexOf(e)>=0}},{key:"remove",value:function(e,t){var i=this,n=[],r=void 0;if(this.minRecords>0&&this._data.length-1<this.minRecords)throw new Error("Minimum record count not met.");if("number"==typeof e)r=e;else if(e&&e.checksum&&null!==e.checksum||e instanceof NGN.DATA.Model)r=this.indexOf(e);else{var o=new this.model(e,!0);r=this._data.findIndex(function(e){return e.checksum===o.checksum})}if(r<0)throw new Error("Record removal failed (record not found at index "+(r||"").toString()+").");if(this._data[r].isDestroyed=!0,n=this._data.splice(r,1),n.isDestroyed=!0,n.length>0){if(n=n[0],this.unapplyIndices(r),this.softDelete){if(this.softDeleteTtl>=0){var a=n.checksum;n.once("expired",function(){i.purgeDeletedRecord(a)}),n.expires=this.softDeleteTtl}this._softarchive.push(n)}if(!this._loading){var s=this._created.indexOf(n);s>=0?s>=0&&this._created.splice(s,1):this._deleted.indexOf(n)<0&&this._deleted.push(n)}return NGN.coalesce(t,!1)||this.emit("record.delete",n,r),n}return null}},{key:"findArchivedRecord",value:function(e){var t=void 0,i=this._softarchive.filter(function(i,n){if(i.checksum===e)return t=n,!0});if(1!==i.length){var n=void 0;try{n=NGN.stack.pop().path}catch(e){n="Unknown"}return console.warn("Cannot purge record. %c"+i.length+" records found%c. Source: %c"+n,NGN.css,"",NGN.css),null}return{index:t,record:i[0]}}},{key:"purgeDeletedRecord",value:function(e){var t=this.findArchivedRecord(e);return null===t?null:(this._softarchive.splice(t.index,1),this.emit("record.purged",t.record),t.record)}},{key:"restore",value:function(e){var t=this.findArchivedRecord(e);return null===t?null:(t.record.removeAllListeners("expired"),t.record.expires=this.softDeleteTtl,this.add(t.record,!0),this._softarchive[t.index].removeAllListeners("expired"),this._softarchive.splice(t.index,1),t.record.isDestroyed=!1,this.emit("record.restored",t.record),t.record)}},{key:"clear",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._softarchive=t?[]:this._data,this._data=[],Object.keys(this._index).forEach(function(t){e._index[t]=[]}),this.emit("clear")}},{key:"find",value:function(e,t){var i=this;if(0===this._data.length)return[];var n=[];switch(void 0===e?"undefined":_typeof(e)){case"function":n=this._data.filter(e);break;case"number":n=e<0||e>=this._data.length?null:this._data[e];break;case"string":var r=this.getIndices(this._data[0].idAttribute,e.trim());if(null!==r&&r.length>0)return r.forEach(function(e){n.push(i._data[e])}),n;var o=this._data.filter(function(t){return(t[t.idAttribute]||"").toString().trim()===e.trim()});n=0===o.length?null:o[0];break;case"object":if(e instanceof NGN.DATA.Model)return this.contains(e)?e:null;var a=[],s=[],l=Object.keys(e);l.forEach(function(t){var n=i.getIndices(t,e[t]);n?a=a.concat(n||[]):null!==t&&s.push(t)}),a.filter(function(e,t){return a.indexOf(e)===t}),s.length>0&&(n=this._data.filter(function(t,i){if(a.indexOf(i)>=0)return!1;for(var n=0;n<s.length;n++)if(t[s[n]]!==e[s[n]])return!1;return!0})),n=n.concat(a.map(function(e){return i._data[e]})).filter(function(t){for(var i=0;i<l.length;i++)if(e[l[i]]!==t[l[i]])return!1;return!0});break;default:n=this._data}return null===n?null:(NGN.coalesce(t,!1)||this.applyFilters(n instanceof Array?n:[n]),n)}},{key:"applyFilters",value:function(e){return 0===this._filters.length?e:(this._filters.forEach(function(t){e=e.filter(t)}),e)}},{key:"addFilter",value:function(e){this._filters.push(e),this.emit("filter.create",e)}},{key:"removeFilter",value:function(e,t){t=NGN.coalesce(t,!1);var i=[];i="number"==typeof e?this._filters.splice(e,1):this._filters.splice(this._filters.indexOf(e),1),i.length>0&&!t&&this.emit("filter.delete",i[0])}},{key:"clearFilters",value:function(e){if(e=NGN.coalesce(e,!1))return void(this._filters=[]);for(;this._filters.length>0;)this.emit("filter.delete",this._filters.pop())}},{key:"deduplicate",value:function(e){var t=this;e=NGN.coalesce(e,!0);var i=this.data.map(function(e){return JSON.stringify(e)}),n=[];i.forEach(function(e,r){i.indexOf(e)<r&&n.push(t.find(r))}),n.forEach(function(e){t.remove(e)})}},{key:"sort",value:function(e){if("function"==typeof e)this.records.sort(e);else if("object"===(void 0===e?"undefined":_typeof(e))){var t=Object.keys(e);this._data.sort(function(i,n){for(var r=0;r<t.length;r++){if(i.hasOwnProperty(t[r])&&!n.hasOwnProperty(t[r]))return 1;if(!i.hasOwnProperty(t[r])&&n.hasOwnProperty(t[r]))return-1;if(i[t[r]]!==n[t[r]])switch(e[t[r]].toString().trim().toLowerCase()){case"asc":return"string"==typeof i.fields[t[r]]?i[t[r]].localeCompare(n[t[r]]):i[t[r]]>n[t[r]]?1:-1;case"desc":return i[t[r]]<n[t[r]]?1:-1;default:return"function"==typeof e[t[r]]?e[t[r]](i,n):0}}return 0})}this.reindex()}},{key:"createIndex",value:function(e,t){this.model.hasOwnProperty(e)||console.warn("The store's model does not contain a data field called %c"+e+"%c.",NGN.css,"");var i=this._index.hasOwnProperty(e);this._index[e]=this._index[e]||[],NGN.coalesce(t,!1)||i||this.emit("index.created",{field:e,store:this})}},{key:"deleteIndex",value:function(e,t){this._index.hasOwnProperty(e)&&(delete this._index[e],NGN.coalesce(t,!1)||this.emit("index.created",{field:e,store:this}))}},{key:"clearIndices",value:function(){var e=this;Object.keys(this._index).forEach(function(t){e._index[t]=[]})}},{key:"deleteIndexes",value:function(e){var t=this;e=NGN.coalesce(e,!0),Object.keys(this._index).forEach(function(i){t.deleteIndex(i,e)})}},{key:"applyIndices",value:function(e,t){var i=this,n=Object.keys(this._index);0!==n.length&&n.forEach(function(n){if(e.hasOwnProperty(n)){for(var r=i._index[n],o=0;o<r.length;o++)if(r[o][0]===e[n])return void i._index[n][o].push(t);i._index[n].push([e[n],t])}})}},{key:"unapplyIndices",value:function(e){var t=this;Object.keys(this._index).forEach(function(i){var n=t._index[i].indexOf(e);n>=0&&t._index[i].splice(n,1)})}},{key:"updateIndice",value:function(e,t,i,n){if(this._index.hasOwnProperty(e)&&t!==i)for(var r=0,o=0;o<this._index[e].length;o++){var a=this._index[e][o][0];if(a===t?(this._index[e][o].splice(this._index[e][o].indexOf(n),1),r++):void 0===i?r++:a===i&&(this._index[e][o].push(n),this._index[e][o].shift(),this._index[e][o].sort(),this._index[e][o].unshift(a),r++),2===r)return}}},{key:"getIndices",value:function(e,t){if(!this._index.hasOwnProperty(e))return null;var i=this._index[e].filter(function(e){return e.length>0&&e[0]===t});return 1===i.length?(i[0].shift(),i[0]):[]}},{key:"move",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0===e?void console.warn("Cannot move record. No source specified."):void 0===t?void console.warn("Cannot move record. No target specified."):(e=this.getRecordIndex(e),t=this.getRecordIndex(t),void(e!==t&&(this._data.splice(t,0,this._data.splice(e,1)[0]),i||this.emit("record.move",{oldIndex:e,newIndex:t,record:this._data[t]}),this.reindex())))}},{key:"getRecordIndex",value:function(e){if(void 0===e)return console.warn("No argument passed to getRecordIndex()."),null;if("number"==typeof e)return e<0||e>=this._data.length?(console.warn("%c"+e+"%c out of bounds.",NGN.css,""),null):e;if("string"==typeof e){var t=e;if(!(e=this.find(t)))return console.warn("%c"+t+"%c does not exist or cannot be found in the store.",NGN.css,""),null}return this.indexOf(e)}},{key:"reindex",value:function(){var e=this;this.clearIndices(),this._data.forEach(function(t,i){e.applyIndices(t,i)})}},{key:"snapshot",value:function(){this.snapshotarchive=NGN.coalesce(this.snapshotarchive,[]);var e={timestamp:(new Date).toJSON(),checksum:NGN.DATA.util.checksum(JSON.stringify(this.data)).toString(),modelChecksums:this.data.map(function(e){return NGN.DATA.util.checksum(JSON.stringify(e)).toString()}),data:this.data};return this.snapshotarchive.unshift(e),this.emit("snapshot",e),e}},{key:"clearSnapshots",value:function(){this.snapshotarchive=null}},{key:"model",get:function(){return this._model}},{key:"proxy",get:function(){return this._proxy},set:function(e){!this._proxy&&e instanceof NGN.DATA.Proxy&&(this._proxy=e,this._proxy.init(this))}},{key:"snapshots",get:function(){return NGN.coalesce(this.snapshotarchive,[])}},{key:"history",get:function(){return this.changelog.reverse()}},{key:"data",get:function(){return this._data.map(function(e){return e.data})}},{key:"representation",get:function(){return this._data.map(function(e){return e.representation})}},{key:"records",get:function(){return this.applyFilters(this._data)}},{key:"recordCount",get:function(){return this.applyFilters(this._data).length}},{key:"filtered",get:function(){var e=this.records;return this._data.filter(function(t){return 0===e.filter(function(e){return e.checksum===t.checksum}).length})}},{key:"first",get:function(){return 0===this.records.length?null:this.records[0]}},{key:"last",get:function(){return 0===this.records.length?null:this.records[this.records.length-1]}}]),t}(NGN.EventEmitter);NGN.DATA.Store=NgnDataStore;var NgnDataProxy=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperties(i,{store:NGN.private(null),initialized:NGN.private(!1),liveSyncEnabled:NGN.private(!1),_enabled:NGN.private(!0),id:NGN.privateconst(NGN.DATA.util.GUID())}),i}return _inherits(t,e),_createClass(t,[{key:"enable",value:function(){this._enabled||(this._enabled=!0,this.emit("enabled"),this.emit("statechange",this.state))}},{key:"disable",value:function(){this._enabled&&(this._enabled=!1,this.emit("disabled"),this.emit("statechange",this.state),this.disableLiveSync())}},{key:"init",value:function(e){var t=this;this.initialized||(this.initialized=!0,this.store=e,e instanceof NGN.DATA.Store&&Object.defineProperties(e,{changelog:NGN.get(function(){return t.changelog})}))}},{key:"save",value:function(){}},{key:"fetch",value:function(){console.warn("Fetch should be overridden by a proxy implementation class.")}},{key:"enableLiveSync",value:function(){this.liveSyncEnabled||(this.liveSyncEnabled=!0,this.switchSync("on"),this.emit("livesync.enabled"))}},{key:"disableLiveSync",value:function(){this.liveSyncEnabled&&(this.liveSyncEnabled=!1,this.switchSync("off"),this.emit("livesync.disabled"))}},{key:"switchSync",value:function(e){"model"===this.type?(this.store[e]("field.create",this.createModelRecord),this.store[e]("field.update",this.updateModelRecord),this.store[e]("field.remove",this.deleteModelRecord),this.store[e]("relationship.remove",this.deleteModelRecord)):(this.store[e]("record.create",this.createStoreRecord),this.store[e]("record.restored",this.createStoreRecord),this.store[e]("record.update",this.updateStoreRecord),this.store[e]("record.delete",this.deleteStoreRecord),this.store[e]("clear",this.clearStoreRecords))}},{key:"createModelRecord",value:function(){this.shouldOverride("createModelRecord")}},{key:"updateModelRecord",value:function(){this.shouldOverride("updateModelRecord")}},{key:"deleteModelRecord",value:function(){this.shouldOverride("deleteModelRecord")}},{key:"createStoreRecord",value:function(){this.shouldOverride("createStoreRecord")}},{key:"updateStoreRecord",value:function(){this.shouldOverride("updateStoreRecord")}},{key:"deleteStoreRecord",value:function(){this.shouldOverride("deleteStoreRecord")}},{key:"clearStoreRecords",value:function(){this.shouldOverride("clearStoreRecords")}},{key:"proxyRecordFilter",value:function(e){return!e.hasOwnProperty("proxyignore")||!e.proxyignore}},{key:"state",get:function(){return this._enabled?"enabled":"disabled"}},{key:"enabled",get:function(){return this._enabled}},{key:"disabled",get:function(){return!this._enabled}},{key:"type",get:function(){return this.store instanceof NGN.DATA.Store?"store":"model"}},{key:"connectionpool",get:function(){return NGN.DATA.ConnectionPool}},{key:"changelog",get:function(){var e=this;return null!==this.store||this instanceof NGN.DATA.Store?{create:this.store._created,update:this.store.records.filter(function(t){return!(e.store._created.indexOf(t)<0&&e.store._deleted.indexOf(t)<0)&&t.modified}).map(function(e){return e}),delete:this.store._deleted}:[]}}],[{key:"shouldOverride",value:function(e){console.warn(e+" should be overridden by a proxy implementation class.")}}]),t}(NGN.EventEmitter);NGN.DATA.Proxy=NgnDataProxy;var NgnHttpProxy=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperties(i,{url:NGN.public(e.url||"http://localhost"),username:NGN.public(e.username||null),password:NGN.public(e.password||null),token:NGN.public(e.token||null)}),i}return _inherits(t,e),_createClass(t,[{key:"init",value:function(e){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),NGN.inherit(this,e)}}]),t}(NGN.DATA.Proxy);NGN.DATA.HttpProxy=NgnHttpProxy;Object.defineProperty(NGN, 'version', NGN.const('1.3.15'));
const n = window.NGN
export { n as default, n as NGN }
//# sourceMappingURL=https://cdn.author.io/ngn/1.3.15/complete.min.js.map
